<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        #container {
            width: 100vw;
            height: 100vh;
        }
        #debug {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            max-width: 300px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="debug">
        <div>Status: <span id="status">Initializing...</span></div>
        <div>GLB File: <span id="file-status">Not loaded</span></div>
        <div>Scene Objects: <span id="scene-count">0</span></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/GLTFLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/OrbitControls.js"></script>

    <script>
        // Debug helpers
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            console.log('Status:', message);
        }
        
        function updateFileStatus(message) {
            document.getElementById('file-status').textContent = message;
            console.log('File Status:', message);
        }
        
        function updateSceneCount() {
            const count = scene.children.length;
            document.getElementById('scene-count').textContent = count;
            console.log('Scene objects:', count);
        }

        updateStatus('Starting Three.js setup...');

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x333333);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        
        document.getElementById('container').appendChild(renderer.domElement);
        updateStatus('Renderer created');

        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        updateStatus('Controls initialized');

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        
        updateStatus('Lighting added');
        updateSceneCount();

        // Add a test cube to verify rendering works
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
        const testCube = new THREE.Mesh(geometry, material);
        testCube.position.set(0, 0, 0);
        scene.add(testCube);
        
        updateStatus('Test cube added (should see green cube)');
        updateSceneCount();

        // Position camera to see the test cube
        camera.position.set(3, 3, 3);
        camera.lookAt(0, 0, 0);

        // Load GLB file
        const loader = new THREE.GLTFLoader();
        updateFileStatus('Attempting to load GLB...');
        
        // Replace 'your-model.glb' with the path to your GLB file
        loader.load('animated_kelp.glb', 
            function(gltf) {
                updateFileStatus('GLB loaded successfully!');
                const model = gltf.scene;
                
                // Remove test cube when model loads
                scene.remove(testCube);
                updateStatus('Test cube removed, GLB model added');
                
                // Enable shadows for the model
                model.traverse(function(node) {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                });
                
                scene.add(model);
                updateSceneCount();
                
                // Auto-center and scale the model
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                model.position.sub(center);
                
                const size = box.getSize(new THREE.Vector3());
                const maxSize = Math.max(size.x, size.y, size.z);
                const scale = 2 / maxSize;
                model.scale.setScalar(scale);
                
                console.log('Model bounds:', size);
                console.log('Model scale:', scale);
                
                updateStatus('GLB model loaded and positioned');
            }, 
            function(progress) {
                const percent = Math.round(progress.loaded / progress.total * 100);
                updateFileStatus(`Loading: ${percent}%`);
                console.log('Loading progress:', percent + '%');
            }, 
            function(error) {
                updateFileStatus('ERROR: Failed to load GLB');
                updateStatus('GLB loading failed - check console');
                console.error('Error loading GLB file:', error);
                console.error('Make sure:');
                console.error('1. The GLB file exists in the same directory');
                console.error('2. The filename is correct');
                console.error('3. You are running through a web server (not file://)');
            }
        );

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        updateStatus('Starting animation loop...');
        animate();
        updateStatus('Running - should see green test cube');
    </script>
</body>
</html>
